{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/noasohier/Desktop/travel-ia-pro/my-clerk-app/app/actions.ts"],"sourcesContent":["'use server'\n\nimport { PrismaClient } from '@prisma/client'\nimport { auth } from '@clerk/nextjs/server'\n\nconst prisma = new PrismaClient()\n\n// --- AI GENERATION ---\nconst OPENROUTER_KEY = process.env.OPENROUTER_KEY;\n\nexport async function generateTrip(params: any) {\n  const { destination, rayon, budget, style, diet, adultes, enfants, animaux, depart, dates, vibes } = params;\n\n  // Recalculate duration if needed\n  let nombreJours = null;\n  if (dates && dates.depart && dates.retour) {\n    const start = new Date(dates.depart);\n    const end = new Date(dates.retour);\n    const diffTime = Math.abs(end.getTime() - start.getTime());\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;\n    if (!isNaN(diffDays) && diffDays > 0) {\n      nombreJours = diffDays;\n    }\n  }\n\n  const prompt = `Tu es une IA experte en voyage \"VELIA\".R√©ponds UNIQUEMENT au format JSON strict.\nAucun texte en dehors du JSON.Aucune phrase d'introduction.\n\nParam√®tres utilisateur:\n{\n  \"destination\": \"${destination}\",\n  \"rayon_decouverte\": \"${rayon > 0 ? rayon + ' km autour' : 'Ville uniquement'}\",\n  \"depart_lieu\": \"${depart}\",\n  \"dates\": \"${dates ? `Du ${dates.depart} au ${dates.retour}` : \"Non sp√©cifi√©es\"}\",\n  \"duree_calculee\": \"${nombreJours ? nombreJours + ' Jours' : 'Non sp√©cifi√©'}\",\n  \"budget\": \"${budget}\",\n  \"style\": \"${style}\",\n  \"vibes_niche\": \"${vibes ? vibes.join(', ') : 'Standard'}\",\n  \"diet\": \"${diet || 'Aucun r√©gime sp√©cifique'}\",\n  \"voyageurs\": { \"adultes\": ${adultes || 1}, \"enfants\": ${enfants || 0} },\n  \"animaux\": ${animaux ? '\"Oui\"' : '\"Non\"'}\n}\n\nINSTRUCTIONS SPECIFIQUES \"STYLE\":\nSi \"style\" contient:\n- \"Roadtrip Moto\": Propose des routes sc√©niques avec virages, parkings s√©curis√©s pour les h√¥tels obligatoires, et des √©tapes adapt√©es aux motards (pauses caf√©, points de vue).\n- \"Trekking\": Inclus des d√©tails sur les sentiers (difficult√©, dur√©e), et privil√©gie les refuges ou h√©bergements proches de la nature.\n- \"Sportif\": Centre le voyage autour d'activit√©s physiques intenses (v√©lo, kayak, rando, sale de sport) et une nutrition adapt√©e.\n\nIMPORTANT SUR LE RAYON:\nSi \"rayon_decouverte\" est sup√©rieur √† 0 km, tu PEUX et DOIS inclure des activit√©s, restaurants ou visites situ√©s dans ce rayon autour de la destination principale. Si c'est \"Ville uniquement\", reste strict.\n\nIMPORTANT SUR LA M√âT√âO:\nUtilise les dates fournies (${dates ? `Du ${dates.depart} au ${dates.retour}` : \"Mois inconnu\"}) pour estimer la m√©t√©o probable (bas√©e sur les normales saisonni√®res).\n\nStructure JSON attendue(STRICT) :\n{\n  \"destination\": \"string\",\n  \"meteo\": {\n    \"temp_min\": \"string (ex: 15¬∞C)\",\n    \"temp_max\": \"string (ex: 22¬∞C)\",\n    \"description\": \"string (ex: Ensoleill√© avec averses possibles)\",\n    \"conseils\": \"string (ex: Pr√©voyez un imperm√©able)\"\n  },\n  \"budget_total_estime\": \"string\",\n  \"transports\": [\n    { \"type\": \"string\", \"compagnie\": \"string\", \"prix\": \"string\", \"lien\": \"string\" }\n  ],\n  \"hotels\": [\n    { \"nom\": \"string\", \"prix_par_nuit\": \"string\", \"avis\": \"string (ex: 4.5/5 sur Google)\", \"emplacement\": \"string\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number } }\n  ],\n  \"restaurants\": [\n    { \"nom\": \"string\", \"type\": \"string\", \"prix_moyen\": \"string\", \"avis\": \"string (ex: 4.7/5 sur TripAdvisor)\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number } }\n  ],\n  \"activites\": [\n    { \"nom\": \"string\", \"prix\": \"string\", \"description\": \"string\", \"avis\": \"string (ex: 4.8/5)\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number }, \"id\": \"string (unique)\" }\n  ],\n  \"itineraire\": [\n    {\n      \"jour\": \"Jour 1\",\n      \"etapes\": [\n        {\n          \"heure\": \"Matin\",\n          \"activite\": \"string\",\n          \"description\": \"string\",\n          \"coordinates\": { \"lat\": number, \"lng\": number }\n        }\n      ]\n    }\n  ]\n}\nGENERE BIEN TOUS LES JOURS DEMAND√âS (${nombreJours}).\n`;\n\n  // Call OpenRouter (similar logic to previous proxy.js)\n  try {\n    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${OPENROUTER_KEY}`,\n        \"Content-Type\": \"application/json\",\n        \"HTTP-Referer\": \"http://localhost:3000\",\n        \"X-Title\": \"Travel Generator Next\"\n      },\n      body: JSON.stringify({\n        model: \"google/gemini-2.0-flash-exp:free\",\n        messages: [{ role: \"user\", content: prompt }]\n      })\n    });\n\n    if (!response.ok) throw new Error(\"API Error\");\n\n    const data = await response.json();\n    const content = data.choices[0].message.content;\n\n    // Clean JSON\n    let cleanText = content.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n    const firstBrace = cleanText.indexOf('{');\n    const lastBrace = cleanText.lastIndexOf('}');\n    if (firstBrace !== -1 && lastBrace !== -1) {\n      cleanText = cleanText.substring(firstBrace, lastBrace + 1);\n    }\n\n    return JSON.parse(cleanText);\n\n  } catch (e: any) {\n    console.error(e);\n    return { error: \"Generation failed\", details: e.message };\n  }\n}\n\n\n// --- DATABASE OPERATIONS ---\n\nexport async function saveTrip(destination: string, tripData: any, requestParams: any = {}) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  // Wrap content to include both result and params\n  const contentToSave = {\n    itinerary: tripData,\n    request: requestParams\n  };\n\n  return await prisma.trip.create({\n    data: {\n      userId,\n      destination,\n      content: JSON.stringify(contentToSave)\n    }\n  });\n}\n\nexport async function getTrips() {\n  const { userId } = await auth();\n  if (!userId) return []; // Return empty if not logged in\n\n  const trips = await prisma.trip.findMany({\n    where: { userId },\n    orderBy: { createdAt: 'desc' }\n  });\n\n  // Parse content back to JSON\n  return trips.map(t => ({ ...t, content: JSON.parse(t.content) }));\n}\n\nexport async function getTrip(id: string) {\n  const { userId } = await auth();\n  if (!userId) return null;\n\n  const trip = await prisma.trip.findUnique({\n    where: { id }\n  });\n\n  if (!trip || trip.userId !== userId) return null;\n\n  return { ...trip, content: JSON.parse(trip.content) };\n}\n\nexport async function deleteTrip(id: string) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  return await prisma.trip.deleteMany({\n    where: { id, userId } // Security: ensure user owns trip\n  });\n}\n"],"names":[],"mappings":";;;;;;;IAUsB,eAAA,WAAA,GAAA,IAAA,wQAAA,EAAA,8CAAA,6PAAA,EAAA,KAAA,GAAA,mQAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/noasohier/Desktop/travel-ia-pro/my-clerk-app/app/actions.ts"],"sourcesContent":["'use server'\n\nimport { PrismaClient } from '@prisma/client'\nimport { auth } from '@clerk/nextjs/server'\n\nconst prisma = new PrismaClient()\n\n// --- AI GENERATION ---\nconst OPENROUTER_KEY = process.env.OPENROUTER_KEY;\n\nexport async function generateTrip(params: any) {\n  const { destination, rayon, budget, style, diet, adultes, enfants, animaux, depart, dates, vibes } = params;\n\n  // Recalculate duration if needed\n  let nombreJours = null;\n  if (dates && dates.depart && dates.retour) {\n    const start = new Date(dates.depart);\n    const end = new Date(dates.retour);\n    const diffTime = Math.abs(end.getTime() - start.getTime());\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;\n    if (!isNaN(diffDays) && diffDays > 0) {\n      nombreJours = diffDays;\n    }\n  }\n\n  const prompt = `Tu es une IA experte en voyage \"VELIA\".R√©ponds UNIQUEMENT au format JSON strict.\nAucun texte en dehors du JSON.Aucune phrase d'introduction.\n\nParam√®tres utilisateur:\n{\n  \"destination\": \"${destination}\",\n  \"rayon_decouverte\": \"${rayon > 0 ? rayon + ' km autour' : 'Ville uniquement'}\",\n  \"depart_lieu\": \"${depart}\",\n  \"dates\": \"${dates ? `Du ${dates.depart} au ${dates.retour}` : \"Non sp√©cifi√©es\"}\",\n  \"duree_calculee\": \"${nombreJours ? nombreJours + ' Jours' : 'Non sp√©cifi√©'}\",\n  \"budget\": \"${budget}\",\n  \"style\": \"${style}\",\n  \"vibes_niche\": \"${vibes ? vibes.join(', ') : 'Standard'}\",\n  \"diet\": \"${diet || 'Aucun r√©gime sp√©cifique'}\",\n  \"voyageurs\": { \"adultes\": ${adultes || 1}, \"enfants\": ${enfants || 0} },\n  \"animaux\": ${animaux ? '\"Oui\"' : '\"Non\"'}\n}\n\nINSTRUCTIONS SPECIFIQUES \"STYLE\":\nSi \"style\" contient:\n- \"Roadtrip Moto\": Propose des routes sc√©niques avec virages, parkings s√©curis√©s pour les h√¥tels obligatoires, et des √©tapes adapt√©es aux motards (pauses caf√©, points de vue).\n- \"Trekking\": Inclus des d√©tails sur les sentiers (difficult√©, dur√©e), et privil√©gie les refuges ou h√©bergements proches de la nature.\n- \"Sportif\": Centre le voyage autour d'activit√©s physiques intenses (v√©lo, kayak, rando, sale de sport) et une nutrition adapt√©e.\n\nIMPORTANT SUR LE RAYON:\nSi \"rayon_decouverte\" est sup√©rieur √† 0 km, tu PEUX et DOIS inclure des activit√©s, restaurants ou visites situ√©s dans ce rayon autour de la destination principale. Si c'est \"Ville uniquement\", reste strict.\n\nIMPORTANT SUR LA M√âT√âO:\nUtilise les dates fournies (${dates ? `Du ${dates.depart} au ${dates.retour}` : \"Mois inconnu\"}) pour estimer la m√©t√©o probable (bas√©e sur les normales saisonni√®res).\n\nStructure JSON attendue(STRICT) :\n{\n  \"destination\": \"string\",\n  \"meteo\": {\n    \"temp_min\": \"string (ex: 15¬∞C)\",\n    \"temp_max\": \"string (ex: 22¬∞C)\",\n    \"description\": \"string (ex: Ensoleill√© avec averses possibles)\",\n    \"conseils\": \"string (ex: Pr√©voyez un imperm√©able)\"\n  },\n  \"budget_total_estime\": \"string\",\n  \"transports\": [\n    { \"type\": \"string\", \"compagnie\": \"string\", \"prix\": \"string\", \"lien\": \"string\" }\n  ],\n  \"hotels\": [\n    { \"nom\": \"string\", \"prix_par_nuit\": \"string\", \"avis\": \"string (ex: 4.5/5 sur Google)\", \"emplacement\": \"string\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number } }\n  ],\n  \"restaurants\": [\n    { \"nom\": \"string\", \"type\": \"string\", \"prix_moyen\": \"string\", \"avis\": \"string (ex: 4.7/5 sur TripAdvisor)\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number } }\n  ],\n  \"activites\": [\n    { \"nom\": \"string\", \"prix\": \"string\", \"description\": \"string\", \"avis\": \"string (ex: 4.8/5)\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number }, \"id\": \"string (unique)\" }\n  ],\n  \"itineraire\": [\n    {\n      \"jour\": \"Jour 1\",\n      \"etapes\": [\n        {\n          \"heure\": \"Matin\",\n          \"activite\": \"string\",\n          \"description\": \"string\",\n          \"coordinates\": { \"lat\": number, \"lng\": number }\n        }\n      ]\n    }\n  ]\n}\nGENERE BIEN TOUS LES JOURS DEMAND√âS (${nombreJours}).\n`;\n\n  // Call OpenRouter (similar logic to previous proxy.js)\n  try {\n    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${OPENROUTER_KEY}`,\n        \"Content-Type\": \"application/json\",\n        \"HTTP-Referer\": \"http://localhost:3000\",\n        \"X-Title\": \"Travel Generator Next\"\n      },\n      body: JSON.stringify({\n        model: \"google/gemini-2.0-flash-exp:free\",\n        messages: [{ role: \"user\", content: prompt }]\n      })\n    });\n\n    if (!response.ok) throw new Error(\"API Error\");\n\n    const data = await response.json();\n    const content = data.choices[0].message.content;\n\n    // Clean JSON\n    let cleanText = content.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n    const firstBrace = cleanText.indexOf('{');\n    const lastBrace = cleanText.lastIndexOf('}');\n    if (firstBrace !== -1 && lastBrace !== -1) {\n      cleanText = cleanText.substring(firstBrace, lastBrace + 1);\n    }\n\n    return JSON.parse(cleanText);\n\n  } catch (e: any) {\n    console.error(e);\n    return { error: \"Generation failed\", details: e.message };\n  }\n}\n\n\n// --- DATABASE OPERATIONS ---\n\nexport async function saveTrip(destination: string, tripData: any, requestParams: any = {}) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  // Wrap content to include both result and params\n  const contentToSave = {\n    itinerary: tripData,\n    request: requestParams\n  };\n\n  return await prisma.trip.create({\n    data: {\n      userId,\n      destination,\n      content: JSON.stringify(contentToSave)\n    }\n  });\n}\n\nexport async function getTrips() {\n  const { userId } = await auth();\n  if (!userId) return []; // Return empty if not logged in\n\n  const trips = await prisma.trip.findMany({\n    where: { userId },\n    orderBy: { createdAt: 'desc' }\n  });\n\n  // Parse content back to JSON\n  return trips.map(t => ({ ...t, content: JSON.parse(t.content) }));\n}\n\nexport async function getTrip(id: string) {\n  const { userId } = await auth();\n  if (!userId) return null;\n\n  const trip = await prisma.trip.findUnique({\n    where: { id }\n  });\n\n  if (!trip || trip.userId !== userId) return null;\n\n  return { ...trip, content: JSON.parse(trip.content) };\n}\n\nexport async function deleteTrip(id: string) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  return await prisma.trip.deleteMany({\n    where: { id, userId } // Security: ensure user owns trip\n  });\n}\n"],"names":[],"mappings":";;;;;;;IAsIsB,WAAA,WAAA,GAAA,IAAA,wQAAA,EAAA,8CAAA,6PAAA,EAAA,KAAA,GAAA,mQAAA,EAAA"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/noasohier/Desktop/travel-ia-pro/my-clerk-app/app/actions.ts"],"sourcesContent":["'use server'\n\nimport { PrismaClient } from '@prisma/client'\nimport { auth } from '@clerk/nextjs/server'\n\nconst prisma = new PrismaClient()\n\n// --- AI GENERATION ---\nconst OPENROUTER_KEY = process.env.OPENROUTER_KEY;\n\nexport async function generateTrip(params: any) {\n  const { destination, rayon, budget, style, diet, adultes, enfants, animaux, depart, dates, vibes } = params;\n\n  // Recalculate duration if needed\n  let nombreJours = null;\n  if (dates && dates.depart && dates.retour) {\n    const start = new Date(dates.depart);\n    const end = new Date(dates.retour);\n    const diffTime = Math.abs(end.getTime() - start.getTime());\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;\n    if (!isNaN(diffDays) && diffDays > 0) {\n      nombreJours = diffDays;\n    }\n  }\n\n  const prompt = `Tu es une IA experte en voyage \"VELIA\".R√©ponds UNIQUEMENT au format JSON strict.\nAucun texte en dehors du JSON.Aucune phrase d'introduction.\n\nParam√®tres utilisateur:\n{\n  \"destination\": \"${destination}\",\n  \"rayon_decouverte\": \"${rayon > 0 ? rayon + ' km autour' : 'Ville uniquement'}\",\n  \"depart_lieu\": \"${depart}\",\n  \"dates\": \"${dates ? `Du ${dates.depart} au ${dates.retour}` : \"Non sp√©cifi√©es\"}\",\n  \"duree_calculee\": \"${nombreJours ? nombreJours + ' Jours' : 'Non sp√©cifi√©'}\",\n  \"budget\": \"${budget}\",\n  \"style\": \"${style}\",\n  \"vibes_niche\": \"${vibes ? vibes.join(', ') : 'Standard'}\",\n  \"diet\": \"${diet || 'Aucun r√©gime sp√©cifique'}\",\n  \"voyageurs\": { \"adultes\": ${adultes || 1}, \"enfants\": ${enfants || 0} },\n  \"animaux\": ${animaux ? '\"Oui\"' : '\"Non\"'}\n}\n\nINSTRUCTIONS SPECIFIQUES \"STYLE\":\nSi \"style\" contient:\n- \"Roadtrip Moto\": Propose des routes sc√©niques avec virages, parkings s√©curis√©s pour les h√¥tels obligatoires, et des √©tapes adapt√©es aux motards (pauses caf√©, points de vue).\n- \"Trekking\": Inclus des d√©tails sur les sentiers (difficult√©, dur√©e), et privil√©gie les refuges ou h√©bergements proches de la nature.\n- \"Sportif\": Centre le voyage autour d'activit√©s physiques intenses (v√©lo, kayak, rando, sale de sport) et une nutrition adapt√©e.\n\nIMPORTANT SUR LE RAYON:\nSi \"rayon_decouverte\" est sup√©rieur √† 0 km, tu PEUX et DOIS inclure des activit√©s, restaurants ou visites situ√©s dans ce rayon autour de la destination principale. Si c'est \"Ville uniquement\", reste strict.\n\nIMPORTANT SUR LA M√âT√âO:\nUtilise les dates fournies (${dates ? `Du ${dates.depart} au ${dates.retour}` : \"Mois inconnu\"}) pour estimer la m√©t√©o probable (bas√©e sur les normales saisonni√®res).\n\nStructure JSON attendue(STRICT) :\n{\n  \"destination\": \"string\",\n  \"meteo\": {\n    \"temp_min\": \"string (ex: 15¬∞C)\",\n    \"temp_max\": \"string (ex: 22¬∞C)\",\n    \"description\": \"string (ex: Ensoleill√© avec averses possibles)\",\n    \"conseils\": \"string (ex: Pr√©voyez un imperm√©able)\"\n  },\n  \"budget_total_estime\": \"string\",\n  \"transports\": [\n    { \"type\": \"string\", \"compagnie\": \"string\", \"prix\": \"string\", \"lien\": \"string\" }\n  ],\n  \"hotels\": [\n    { \"nom\": \"string\", \"prix_par_nuit\": \"string\", \"avis\": \"string (ex: 4.5/5 sur Google)\", \"emplacement\": \"string\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number } }\n  ],\n  \"restaurants\": [\n    { \"nom\": \"string\", \"type\": \"string\", \"prix_moyen\": \"string\", \"avis\": \"string (ex: 4.7/5 sur TripAdvisor)\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number } }\n  ],\n  \"activites\": [\n    { \"nom\": \"string\", \"prix\": \"string\", \"description\": \"string\", \"avis\": \"string (ex: 4.8/5)\", \"lien\": \"string\", \"coordinates\": { \"lat\": number, \"lng\": number }, \"id\": \"string (unique)\" }\n  ],\n  \"itineraire\": [\n    {\n      \"jour\": \"Jour 1\",\n      \"etapes\": [\n        {\n          \"heure\": \"Matin\",\n          \"activite\": \"string\",\n          \"description\": \"string\",\n          \"coordinates\": { \"lat\": number, \"lng\": number }\n        }\n      ]\n    }\n  ]\n}\nGENERE BIEN TOUS LES JOURS DEMAND√âS (${nombreJours}).\n`;\n\n  // Call OpenRouter (similar logic to previous proxy.js)\n  try {\n    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${OPENROUTER_KEY}`,\n        \"Content-Type\": \"application/json\",\n        \"HTTP-Referer\": \"http://localhost:3000\",\n        \"X-Title\": \"Travel Generator Next\"\n      },\n      body: JSON.stringify({\n        model: \"google/gemini-2.0-flash-exp:free\",\n        messages: [{ role: \"user\", content: prompt }]\n      })\n    });\n\n    if (!response.ok) throw new Error(\"API Error\");\n\n    const data = await response.json();\n    const content = data.choices[0].message.content;\n\n    // Clean JSON\n    let cleanText = content.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n    const firstBrace = cleanText.indexOf('{');\n    const lastBrace = cleanText.lastIndexOf('}');\n    if (firstBrace !== -1 && lastBrace !== -1) {\n      cleanText = cleanText.substring(firstBrace, lastBrace + 1);\n    }\n\n    return JSON.parse(cleanText);\n\n  } catch (e: any) {\n    console.error(e);\n    return { error: \"Generation failed\", details: e.message };\n  }\n}\n\n\n// --- DATABASE OPERATIONS ---\n\nexport async function saveTrip(destination: string, tripData: any, requestParams: any = {}) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  // Wrap content to include both result and params\n  const contentToSave = {\n    itinerary: tripData,\n    request: requestParams\n  };\n\n  return await prisma.trip.create({\n    data: {\n      userId,\n      destination,\n      content: JSON.stringify(contentToSave)\n    }\n  });\n}\n\nexport async function getTrips() {\n  const { userId } = await auth();\n  if (!userId) return []; // Return empty if not logged in\n\n  const trips = await prisma.trip.findMany({\n    where: { userId },\n    orderBy: { createdAt: 'desc' }\n  });\n\n  // Parse content back to JSON\n  return trips.map(t => ({ ...t, content: JSON.parse(t.content) }));\n}\n\nexport async function getTrip(id: string) {\n  const { userId } = await auth();\n  if (!userId) return null;\n\n  const trip = await prisma.trip.findUnique({\n    where: { id }\n  });\n\n  if (!trip || trip.userId !== userId) return null;\n\n  return { ...trip, content: JSON.parse(trip.content) };\n}\n\nexport async function deleteTrip(id: string) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  return await prisma.trip.deleteMany({\n    where: { id, userId } // Security: ensure user owns trip\n  });\n}\n"],"names":[],"mappings":";;;;;;;IAsKsB,UAAA,WAAA,GAAA,IAAA,wQAAA,EAAA,8CAAA,6PAAA,EAAA,KAAA,GAAA,mQAAA,EAAA"}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///Users/noasohier/Desktop/travel-ia-pro/my-clerk-app/components/EmergencyButton.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { createPortal } from 'react-dom';\n\nconst EmergencyButton = ({ onEmergency }: { onEmergency: (context: string) => Promise<void> }) => {\n    const [isOpen, setIsOpen] = useState(false);\n    const [context, setContext] = useState('');\n    const [loading, setLoading] = useState(false);\n\n    const handleSubmit = async () => {\n        if (!context) return;\n        setLoading(true);\n        await onEmergency(context);\n        setLoading(false);\n        setIsOpen(false);\n        setContext('');\n    };\n\n    return (\n        <div className=\"w-full relative\">\n            <button\n                onClick={() => setIsOpen(true)}\n                className=\"w-full py-4 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center gap-2\"\n            >\n                <i className=\"fa-solid fa-triangle-exclamation\"></i> Mode Impr√©vu\n            </button>\n            <div className=\"mt-3 p-3 bg-red-50 border border-red-100 rounded-lg text-xs text-red-800 text-center leading-relaxed\">\n                <strong>√Ä quoi sert ce bouton ?</strong><br />\n                Un impr√©vu (pluie, fatigue, lieu ferm√©) ? Cliquez ici pour que l'IA r√©adapte instantan√©ment votre itin√©raire au contexte actuel.\n            </div>\n\n            {isOpen && (\n                <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n                    <div className=\"bg-white p-6 rounded-2xl shadow-2xl w-full max-w-md animate-fade-in-up relative\">\n                        <div className=\"flex justify-between items-center mb-4\">\n                            <h3 className=\"text-xl font-bold text-red-600 flex items-center gap-2\">\n                                <i className=\"fa-solid fa-triangle-exclamation\"></i> SOS Voyage\n                            </h3>\n                            <button onClick={() => setIsOpen(false)} className=\"text-slate-400 hover:text-slate-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 transition\">\n                                <i className=\"fa-solid fa-xmark text-xl\"></i>\n                            </button>\n                        </div>\n\n                        <p className=\"text-sm text-slate-600 mb-4 font-medium\">Quel est le probl√®me ? L'IA va r√©organiser votre journ√©e.</p>\n\n                        <div className=\"flex gap-2 mb-4 overflow-x-auto pb-2 no-scrollbar\">\n                            {[\"‚õàÔ∏è Il pleut\", \"üò¥ Trop fatigu√©\", \"üö´ Lieu ferm√©\", \"üïí Manque de temps\"].map(opt => (\n                                <button\n                                    key={opt}\n                                    onClick={() => setContext(opt)}\n                                    className=\"text-xs bg-slate-100 hover:bg-red-50 hover:text-red-600 px-3 py-2 rounded-full whitespace-nowrap transition border border-slate-200 font-semibold\"\n                                >\n                                    {opt}\n                                </button>\n                            ))}\n                        </div>\n\n                        <textarea\n                            value={context}\n                            onChange={(e) => setContext(e.target.value)}\n                            placeholder=\"D√©crivez l'impr√©vu...\"\n                            className=\"w-full text-sm p-3 border border-slate-200 rounded-xl mb-4 focus:ring-2 focus:ring-red-500 outline-none min-h-[100px] resize-none\"\n                        />\n\n                        <button\n                            onClick={handleSubmit}\n                            disabled={loading || !context}\n                            className=\"w-full bg-red-500 text-white font-bold py-3 rounded-xl hover:bg-red-600 disabled:opacity-50 transition flex justify-center items-center gap-2 shadow-md hover:shadow-lg transform active:scale-95\"\n                        >\n                            {loading ? <i className=\"fa-solid fa-spinner animate-spin\"></i> : <i className=\"fa-solid fa-wand-magic-sparkles\"></i>}\n                            G√©n√©rer une alternative\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default EmergencyButton;\n"],"names":[],"mappings":";;;;;AAAA;;;;AAGA,MAAM,kBAAkB,CAAC,EAAE,WAAW,EAAuD;;IACzF,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+LAAQ,EAAC;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+LAAQ,EAAC;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+LAAQ,EAAC;IAEvC,MAAM,eAAe;QACjB,IAAI,CAAC,SAAS;QACd,WAAW;QACX,MAAM,YAAY;QAClB,WAAW;QACX,UAAU;QACV,WAAW;IACf;IAEA,qBACI,mNAAC;QAAI,WAAU;;0BACX,mNAAC;gBACG,SAAS,IAAM,UAAU;gBACzB,WAAU;;kCAEV,mNAAC;wBAAE,WAAU;;;;;;oBAAuC;;;;;;;0BAExD,mNAAC;gBAAI,WAAU;;kCACX,mNAAC;kCAAO;;;;;;kCAAgC,mNAAC;;;;;oBAAK;;;;;;;YAIjD,wBACG,mNAAC;gBAAI,WAAU;0BACX,cAAA,mNAAC;oBAAI,WAAU;;sCACX,mNAAC;4BAAI,WAAU;;8CACX,mNAAC;oCAAG,WAAU;;sDACV,mNAAC;4CAAE,WAAU;;;;;;wCAAuC;;;;;;;8CAExD,mNAAC;oCAAO,SAAS,IAAM,UAAU;oCAAQ,WAAU;8CAC/C,cAAA,mNAAC;wCAAE,WAAU;;;;;;;;;;;;;;;;;sCAIrB,mNAAC;4BAAE,WAAU;sCAA0C;;;;;;sCAEvD,mNAAC;4BAAI,WAAU;sCACV;gCAAC;gCAAe;gCAAmB;gCAAiB;6BAAqB,CAAC,GAAG,CAAC,CAAA,oBAC3E,mNAAC;oCAEG,SAAS,IAAM,WAAW;oCAC1B,WAAU;8CAET;mCAJI;;;;;;;;;;sCASjB,mNAAC;4BACG,OAAO;4BACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;4BAC1C,aAAY;4BACZ,WAAU;;;;;;sCAGd,mNAAC;4BACG,SAAS;4BACT,UAAU,WAAW,CAAC;4BACtB,WAAU;;gCAET,wBAAU,mNAAC;oCAAE,WAAU;;;;;6FAA0C,mNAAC;oCAAE,WAAU;;;;;;gCAAuC;;;;;;;;;;;;;;;;;;;;;;;;AAQlJ;GAzEM;KAAA;uCA2ES"}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///Users/noasohier/Desktop/travel-ia-pro/my-clerk-app/app/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useUser, UserButton, SignInButton, SignedIn, SignedOut } from \"@clerk/nextjs\";\nimport { generateTrip, saveTrip, getTrip } from './actions';\nimport { useSearchParams, useRouter } from 'next/navigation';\nimport Link from 'next/link';\n\n// Dynamically import ItineraryBuilder\nimport dynamic from 'next/dynamic';\nconst ItineraryBuilder = dynamic(() => import('../components/ItineraryBuilder'), { ssr: false });\nimport EmergencyButton from '../components/EmergencyButton';\n\n// Constants (Copied from original App.jsx)\nconst VACATION_STYLES = [\n  { value: \"Aventure et nature\", label: \"Aventure\", icon: \"üèîÔ∏è\" },\n  { value: \"D√©tente et plage\", label: \"D√©tente\", icon: \"üßò‚Äç‚ôÄÔ∏è\" },\n  { value: \"Culture et histoire\", label: \"Culture\", icon: \"üèõÔ∏è\" },\n  { value: \"Gastronomie\", label: \"Gastronomie\", icon: \"üçΩÔ∏è\" },\n  { value: \"Shopping et ville\", label: \"Shopping\", icon: \"üõçÔ∏è\" },\n  { value: \"Romantique\", label: \"Romantique\", icon: \"üíï\" },\n  { value: \"Famille\", label: \"Famille\", icon: \"üë®‚Äçüë©‚Äçüëß‚Äçüë¶\" },\n  { value: \"Sportif\", label: \"Sportif\", icon: \"üèÉ\" },\n  { value: \"Roadtrip Moto\", label: \"Roadtrip Moto\", icon: \"üèçÔ∏è\" },\n  { value: \"Trekking\", label: \"Trekking\", icon: \"ü•æ\" }\n];\n\nconst VIBES_NICHE = [\n  { value: \"Digital Nomad\", label: \"Digital Nomad (WiFi)\", icon: \"üíª\" },\n  { value: \"Pet Friendly\", label: \"Pet Friendly\", icon: \"üê∂\" },\n  { value: \"Accessibilit√© PMR\", label: \"Accessibilit√© PMR\", icon: \"‚ôø\" },\n  { value: \"Nature & D√©connexion\", label: \"Nature & D√©connexion\", icon: \"üå≤\" },\n  { value: \"Vie Nocturne\", label: \"Vie Nocturne\", icon: \"üç∏\" }\n];\n\nconst DIETARY_OPTIONS = [\n  { value: \"V√©g√©tarien\", label: \"V√©g√©tarien\", icon: \"ü•ó\" },\n  { value: \"V√©gan\", label: \"V√©gan\", icon: \"üå±\" },\n  { value: \"Halal\", label: \"Halal\", icon: \"‚ò™Ô∏è\" },\n  { value: \"Casher\", label: \"Casher\", icon: \"üïç\" },\n  { value: \"Sans gluten\", label: \"Sans gluten\", icon: \"üåæ\" },\n  { value: \"Sans lactose\", label: \"Sans lactose\", icon: \"ü•õ\" },\n  { value: \"Pesc√©tarien\", label: \"Pesc√©tarien\", icon: \"üêü\" }\n];\n\nconst BUDGET_MAPPING = [\n  { label: \"Petit\", value: \"Petit budget (500-1000‚Ç¨)\", rangeLabel: \"500-1k‚Ç¨\" },\n  { label: \"Moyen\", value: \"Budget moyen (1000-2500‚Ç¨)\", rangeLabel: \"1k-2.5k‚Ç¨\" },\n  { label: \"Confort\", value: \"Budget confortable (2500-5000‚Ç¨)\", rangeLabel: \"2.5k-5k‚Ç¨\" },\n  { label: \"Luxe\", value: \"Budget luxe (5000‚Ç¨+)\", rangeLabel: \"5k‚Ç¨+\" }\n];\n\n\nexport default function Home() {\n  const { user, isLoaded } = useUser();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const tripId = searchParams.get('tripId');\n\n  // STATE\n  const [depart, setDepart] = useState(\"\");\n  const [destination, setDestination] = useState(\"\");\n  const [rayon, setRayon] = useState(0);\n  const [budgetIndex, setBudgetIndex] = useState(1);\n  const [styles, setStyles] = useState<string[]>([]);\n  const [vibes, setVibes] = useState<string[]>([]);\n  const [diets, setDiets] = useState<string[]>([]);\n  const [travelers, setTravelers] = useState({ adultes: 2, enfants: 0, animaux: false });\n  const [dates, setDates] = useState({ depart: \"\", retour: \"\" });\n\n  // Result State\n  const [loading, setLoading] = useState(false);\n  const [resultat, setResultat] = useState<any>(null);\n  const [error, setError] = useState(\"\");\n  const [activeDay, setActiveDay] = useState(0);\n  const [saving, setSaving] = useState(false);\n\n  // Load Trip if ID present\n  useEffect(() => {\n    if (tripId && isLoaded) {\n      setLoading(true);\n      getTrip(tripId).then((trip) => {\n        if (trip) {\n          const content = trip.content;\n\n          // Handle Backward Compatibility (Old format vs New format)\n          if (content.request) {\n            // New format: restore inputs\n            setResultat(content.itinerary);\n            setDestination(content.request.destination || trip.destination);\n            setDepart(content.request.depart || \"\");\n            setRayon(content.request.rayon || 0);\n            setBudgetIndex(BUDGET_MAPPING.findIndex(b => b.value === content.request.budget) !== -1 ? BUDGET_MAPPING.findIndex(b => b.value === content.request.budget) : 1);\n            setStyles(content.request.styles || []); // Note: splitted styles string or array\n            setVibes(content.request.vibes || []);\n            setDiets(content.request.diets || []);\n            setDates(content.request.dates || { depart: \"\", retour: \"\" });\n            setTravelers(content.request.travelers || { adultes: 2, enfants: 0, animaux: false });\n\n            // Parse styles back if it was saved as string (depends on how we passed it)\n            // In handleSave we will pass array strictly\n          } else {\n            // Old format: just itinerary\n            setResultat(content);\n            setDestination(trip.destination);\n          }\n        } else {\n          setError(\"Voyage introuvable ou acc√®s refus√©.\");\n        }\n        setLoading(false);\n      });\n    }\n  }, [tripId, isLoaded]);\n\n  const getImageUrl = (item: any, type: string, locationName: string) => {\n    const query = `${item.nom} ${locationName} ${type} aesthetic travel photography high resolution`;\n    return `https://image.pollinations.ai/prompt/${encodeURIComponent(query)}?width=800&height=600&nologo=true`;\n  };\n\n\n  const handleSubmit = async () => {\n    const budget = BUDGET_MAPPING[budgetIndex].value;\n\n    if (!destination || styles.length === 0 || !dates.depart || !dates.retour) {\n      alert(\"Remplis tous les champs, notamment les dates !\");\n      return;\n    }\n\n    setLoading(true);\n    setError(\"\");\n    setResultat(null);\n    setActiveDay(0);\n\n    // Call Server Action\n    const res = await generateTrip({\n      destination, rayon, budget,\n      style: styles.join(', '),\n      depart, dates,\n      vibes: vibes,\n      diet: diets.join(', '),\n      adultes: travelers.adultes, enfants: travelers.enfants, animaux: travelers.animaux\n    });\n\n    if (res.error) {\n      setError(\"Erreur IA: \" + res.details);\n    } else {\n      setResultat(res);\n    }\n    setLoading(false);\n  };\n\n  const handleEmergency = async (context: string) => {\n    alert(\"La fonction d'urgence sera bient√¥t disponible via l'IA !\");\n  };\n\n  const handleSave = async () => {\n    if (!resultat) return;\n    setSaving(true);\n\n    // Prepare params object to save\n    const requestParams = {\n      destination,\n      depart,\n      rayon,\n      budget: BUDGET_MAPPING[budgetIndex].value,\n      styles, // Save as array for easier restore\n      vibes,\n      diets, // save diets as array for easier restore (was implicitly handled as string in generate)\n      dates,\n      travelers\n    };\n\n    try {\n      await saveTrip(destination, resultat, requestParams);\n      alert(\"Voyage enregistr√© !\");\n      router.push('/dashboard');\n    } catch (e) {\n      console.error(e);\n      alert(\"Erreur lors de l'enregistrement.\");\n    }\n    setSaving(false);\n  };\n\n  const updateResultat = (newItinerary: any) => {\n    setResultat(newItinerary);\n  };\n\n\n  return (\n    // Responsive Wrapper: Stacked on Mobile (h-screen + scroll), Side-by-Side on Desktop (h-screen + no-scroll)\n    <div className=\"bg-slate-50 text-slate-800 h-screen w-full flex flex-col lg:flex-row overflow-y-auto lg:overflow-hidden font-sans\">\n\n      {/* Left Panel: Form */}\n      <div className=\"w-full lg:w-1/2 h-auto lg:h-full lg:overflow-y-auto custom-scrollbar bg-white relative z-10 flex flex-col shadow-xl lg:shadow-none\">\n\n        {/* Auth & Logo Header (Inside Left Panel) */}\n        <div className=\"px-8 pt-8 flex justify-between items-start\">\n          <div className=\"flex items-center\">\n            <div className=\"h-10 w-10 bg-gradient-to-br from-indigo-800 to-[#FF7F50] rounded-lg flex items-center justify-center text-white font-bold text-xl mr-3 font-serif\">V</div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-slate-900 tracking-wide\">VELIA</h1>\n              <p className=\"text-indigo-600 text-xs font-bold uppercase tracking-widest -mt-1\">√âvasions Intelligentes</p>\n            </div>\n          </div>\n\n          {/* Authentication Controls */}\n          <div className=\"flex items-center gap-3\">\n            <SignedIn>\n              <Link href=\"/dashboard\" className=\"text-xs font-bold text-slate-500 hover:text-indigo-600 uppercase tracking-wider\">\n                <i className=\"fa-solid fa-suitcase\"></i> Mes Voyages\n              </Link>\n              <div className=\"flex items-center gap-2 pl-2 border-l border-slate-100\">\n                <UserButton showName={false} />\n              </div>\n            </SignedIn>\n            <SignedOut>\n              <SignInButton mode=\"modal\">\n                <button className=\"text-xs font-bold bg-slate-100 hover:bg-slate-200 text-slate-700 px-3 py-2 rounded-lg transition uppercase tracking-wider\">\n                  Connexion\n                </button>\n              </SignInButton>\n            </SignedOut>\n          </div>\n        </div>\n\n\n        <div className=\"max-w-xl mx-auto px-8 pb-12 w-full mt-4\">\n          <p className=\"text-slate-500 text-xs lg:text-sm mb-8\">Configurez votre voyage de r√™ve en 3 clics.</p>\n\n          <div className=\"space-y-8\">\n\n            {/* Lieux */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">Lieu de d√©part</label>\n                <div className=\"relative\">\n                  <i className=\"fa-solid fa-plane-departure absolute left-4 top-3.5 text-indigo-400\"></i>\n                  <input\n                    type=\"text\"\n                    placeholder=\"Ex: Paris, Lyon...\"\n                    value={depart}\n                    onChange={(e) => setDepart(e.target.value)}\n                    className=\"w-full pl-10 pr-4 py-3 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-indigo-500 transition shadow-sm placeholder-slate-400 font-medium outline-none\"\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">Destination</label>\n                <div className=\"relative\">\n                  <i className=\"fa-solid fa-location-dot absolute left-4 top-3.5 text-pink-500\"></i>\n                  <input\n                    type=\"text\"\n                    placeholder=\"Ex: Tokyo, Bali...\"\n                    value={destination}\n                    onChange={(e) => setDestination(e.target.value)}\n                    className=\"w-full pl-10 pr-4 py-3 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-pink-500 transition shadow-sm placeholder-slate-400 font-medium outline-none\"\n                  />\n                  {/* Rayon Slider */}\n                  <div className=\"mt-2 px-1 flex items-center gap-3\">\n                    <i className=\"fa-solid fa-circle-nodes text-slate-400 text-xs\"></i>\n                    <input\n                      type=\"range\"\n                      min=\"0\"\n                      max=\"100\"\n                      step=\"10\"\n                      value={rayon}\n                      onChange={(e) => setRayon(parseInt(e.target.value))}\n                      className=\"w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-500\"\n                    />\n                    <span className=\"text-[10px] font-bold text-slate-500 whitespace-nowrap min-w-[60px] text-right\">\n                      {rayon === 0 ? \"Ville\" : `+ ${rayon} km`}\n                    </span>\n                  </div>\n                  <p className=\"text-[10px] text-slate-400 mt-1 pl-1 italic\">\n                    Explorez un large √©ventail d'activit√©s √† deux pas de la ville\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Dates REQUIRED */}\n            <div className=\"space-y-2\">\n              <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">Quand ? (Dates requises)</label>\n              <div className=\"flex items-center bg-slate-50 rounded-xl p-1 shadow-sm border border-slate-100 relative\">\n                <div className=\"relative w-1/2\">\n                  <span className=\"absolute top-1 left-3 text-[10px] text-slate-400 font-bold uppercase tracking-wider pointer-events-none\">D√©part</span>\n                  <input\n                    type=\"date\"\n                    min={new Date().toISOString().split('T')[0]}\n                    value={dates.depart}\n                    onChange={(e) => setDates({ ...dates, depart: e.target.value })}\n                    className=\"w-full bg-transparent border-none pt-5 pb-1 px-3 text-sm focus:ring-0 text-slate-700 font-medium cursor-pointer relative z-10 outline-none\"\n                  />\n                </div>\n                <span className=\"text-slate-300\">|</span>\n                <div className=\"relative w-1/2\">\n                  <span className=\"absolute top-1 left-3 text-[10px] text-slate-400 font-bold uppercase tracking-wider pointer-events-none\">Retour</span>\n                  <input\n                    type=\"date\"\n                    min={dates.depart || new Date().toISOString().split('T')[0]}\n                    value={dates.retour}\n                    onChange={(e) => setDates({ ...dates, retour: e.target.value })}\n                    className=\"w-full bg-transparent border-none pt-5 pb-1 px-3 text-sm focus:ring-0 text-slate-700 font-medium cursor-pointer relative z-10 outline-none\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* Budget Slider */}\n            <div className=\"space-y-2\">\n              <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500 flex justify-between\">\n                <span>Budget</span>\n                <span className=\"text-indigo-600 font-bold\">{BUDGET_MAPPING[budgetIndex].rangeLabel}</span>\n              </label>\n              <input\n                type=\"range\"\n                min=\"0\" max=\"3\" step=\"1\"\n                value={budgetIndex}\n                onChange={(e) => setBudgetIndex(parseInt(e.target.value))}\n                className=\"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600\"\n              />\n              <div className=\"flex justify-between text-[10px] text-slate-400 uppercase font-bold\">\n                <span>√âco</span>\n                <span>Moyen</span>\n                <span>Confort</span>\n                <span>Luxe</span>\n              </div>\n            </div>\n\n            <hr className=\"border-slate-100\" />\n\n            {/* Styles */}\n            <div className=\"space-y-3\">\n              <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">Style de voyage</label>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                {VACATION_STYLES.map((styleItem) => {\n                  const isSelected = styles.includes(styleItem.value);\n                  return (\n                    <div\n                      key={styleItem.value}\n                      onClick={() => {\n                        if (isSelected) {\n                          setStyles(styles.filter(s => s !== styleItem.value));\n                        } else {\n                          setStyles([...styles, styleItem.value]);\n                        }\n                      }}\n                      className={`cursor-pointer rounded-xl p-3 text-center transition hover:shadow-md border-2\n                                            ${isSelected\n                          ? 'border-indigo-500 bg-indigo-50 text-indigo-700'\n                          : 'border-slate-200 hover:border-indigo-300 hover:bg-white text-slate-600'\n                        }`}\n                    >\n                      <div className=\"text-2xl mb-1\">{styleItem.icon}</div>\n                      <div className=\"text-xs font-bold\">{styleItem.label}</div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* VIBES */}\n            <div className=\"space-y-3\">\n              <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">Ambiance</label>\n              <div className=\"flex flex-wrap gap-2\">\n                {VIBES_NICHE.map((vibe) => {\n                  const isSelected = vibes.includes(vibe.value);\n                  return (\n                    <div\n                      key={vibe.value}\n                      onClick={() => {\n                        if (isSelected) setVibes(vibes.filter(v => v !== vibe.value));\n                        else setVibes([...vibes, vibe.value]);\n                      }}\n                      className={`cursor-pointer rounded-full px-4 py-2 text-xs font-bold transition flex items-center gap-2 border shadow-sm\n                                            ${isSelected ? 'bg-purple-100 text-purple-700 border-purple-200' : 'bg-white text-slate-600 border-slate-200 hover:border-purple-300'}`}\n                    >\n                      <span>{vibe.icon}</span> {vibe.label}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Diets */}\n            <div className=\"space-y-3\">\n              <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500\">R√©gime Alimentaire</label>\n              <div className=\"flex flex-wrap gap-2\">\n                {DIETARY_OPTIONS.map((diet) => {\n                  const isSelected = diets.includes(diet.value);\n                  return (\n                    <div\n                      key={diet.value}\n                      onClick={() => {\n                        if (isSelected) setDiets(diets.filter(d => d !== diet.value));\n                        else setDiets([...diets, diet.value]);\n                      }}\n                      className={`cursor-pointer rounded-full px-4 py-2 text-xs font-bold transition flex items-center gap-2 border\n                                            ${isSelected ? 'bg-pink-100 text-pink-600 border-pink-200' : 'bg-white text-slate-500 border-slate-200 hover:border-pink-300'}`}\n                    >\n                      <span>{diet.icon}</span> {diet.label}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Travelers */}\n            <div className=\"grid grid-cols-1 gap-4\">\n              <div className=\"bg-white border border-slate-200 rounded-xl p-4 shadow-sm flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"bg-indigo-100 text-indigo-600 w-10 h-10 rounded-full flex items-center justify-center\"><i className=\"fa-solid fa-user-group\"></i></div>\n                  <div><p className=\"text-sm font-bold text-slate-800\">Adultes</p><p className=\"text-xs text-slate-500\">12 ans et +</p></div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <button onClick={() => setTravelers({ ...travelers, adultes: Math.max(1, travelers.adultes - 1) })} className=\"w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-indigo-100 hover:text-indigo-600 transition flex items-center justify-center\">-</button>\n                  <span className=\"font-bold text-slate-800 w-4 text-center\">{travelers.adultes}</span>\n                  <button onClick={() => setTravelers({ ...travelers, adultes: travelers.adultes + 1 })} className=\"w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-indigo-100 hover:text-indigo-600 transition flex items-center justify-center\">+</button>\n                </div>\n              </div>\n              <div className=\"bg-white border border-slate-200 rounded-xl p-4 shadow-sm flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"bg-pink-100 text-pink-600 w-10 h-10 rounded-full flex items-center justify-center\"><i className=\"fa-solid fa-child\"></i></div>\n                  <div><p className=\"text-sm font-bold text-slate-800\">Enfants</p><p className=\"text-xs text-slate-500\">Moins de 12 ans</p></div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <button onClick={() => setTravelers({ ...travelers, enfants: Math.max(0, travelers.enfants - 1) })} className=\"w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-pink-100 hover:text-pink-600 transition flex items-center justify-center\">-</button>\n                  <span className=\"font-bold text-slate-800 w-4 text-center\">{travelers.enfants}</span>\n                  <button onClick={() => setTravelers({ ...travelers, enfants: travelers.enfants + 1 })} className=\"w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-pink-100 hover:text-pink-600 transition flex items-center justify-center\">+</button>\n                </div>\n              </div>\n            </div>\n\n            {/* Animaux */}\n            <div\n              onClick={() => setTravelers({ ...travelers, animaux: !travelers.animaux })}\n              className={`cursor-pointer flex items-center justify-between p-4 rounded-xl border transition\n                            ${travelers.animaux ? 'bg-indigo-50 border-indigo-200' : 'bg-slate-50 border-transparent'}`}\n            >\n              <div className=\"flex items-center gap-2 text-sm font-semibold text-slate-600\">\n                <i className={`fa-solid fa-paw ${travelers.animaux ? 'text-indigo-500' : 'text-slate-400'}`}></i>\n                Voyager avec un animal ?\n              </div>\n              <div className={`w-10 h-5 rounded-full relative transition ${travelers.animaux ? 'bg-indigo-500' : 'bg-slate-300'}`}>\n                <div className={`absolute top-1 left-1 bg-white w-3 h-3 rounded-full transition transform ${travelers.animaux ? 'translate-x-5' : 'translate-x-0'}`}></div>\n              </div>\n            </div>\n\n            <button\n              type=\"button\"\n              onClick={handleSubmit}\n              disabled={loading}\n              className=\"group w-full py-4 px-6 rounded-xl bg-gradient-to-r from-indigo-600 to-pink-500 text-white font-bold text-lg shadow-lg hover:shadow-indigo-500/30 transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed\"\n            >\n              <span>{loading ? 'G√©n√©ration en cours...' : 'G√©n√©rer mon voyage'}</span>\n              <i className={`fa-solid fa-wand-magic-sparkles ${!loading && 'group-hover:animate-pulse'}`}></i>\n            </button>\n\n            {error && (\n              <div className=\"bg-red-50 text-red-600 p-4 rounded-xl text-center text-sm font-bold\">\n                {error}\n              </div>\n            )}\n\n          </div>\n          <p className=\"mt-6 text-center text-xs text-slate-400\">Powered by Advanced AI ‚Ä¢ ¬© 2025 VELIA</p>\n        </div>\n      </div>\n\n      {/* Right Panel: Results or Image */}\n      <div className={`w-full lg:w-1/2 relative bg-slate-100 lg:overflow-y-auto custom-scrollbar\n                ${!resultat ? 'h-[500px] lg:h-full' : 'h-auto lg:h-full min-h-[500px]'}\n            `}>\n        {!resultat ? (\n          // Placeholder Image (Exact match from original)\n          <div className=\"h-full w-full relative\">\n            <img src=\"https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=80&w=2070&auto=format&fit=crop\" alt=\"Travel Background\" className=\"absolute inset-0 w-full h-full object-cover\" />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent\"></div>\n            <div className=\"absolute bottom-8 left-6 right-6 lg:bottom-16 lg:left-12 lg:right-12 text-white\">\n              <div className=\"inline-block px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-xs font-medium mb-4 border border-white/30\">\n                ‚ú® Nouvelle version disponible\n              </div>\n              <h2 className=\"text-3xl lg:text-5xl font-serif mb-4 leading-tight\">Le monde est grand.<br />Explorez-le mieux.</h2>\n              <p className=\"text-sm lg:text-lg text-slate-200 font-light max-w-md\">Notre IA analyse des milliers d'itin√©raires pour cr√©er le voyage parfait, adapt√© √† votre rythme et vos envies.</p>\n            </div>\n          </div>\n        ) : (\n          // Results Display\n          <div className=\"p-8 space-y-8 min-h-full pb-24\">\n            <div id=\"itinerary-container\" className=\"space-y-8 animate-fade-in-up\">\n              {/* Header Result */}\n              <div className=\"bg-white p-8 rounded-2xl shadow-sm text-center border border-indigo-50 relative\">\n                <h2 className=\"text-3xl font-serif font-bold text-indigo-900 mb-2\">\n                  ‚úàÔ∏è Voyage √† {resultat.destination}\n                </h2>\n                {/* Save Button ABSOLUTE in header */}\n                <div className=\"absolute top-4 right-4\">\n                  <SignedIn>\n                    {!tripId && (\n                      <button\n                        onClick={handleSave}\n                        disabled={saving}\n                        className=\"w-10 h-10 bg-indigo-100 hover:bg-indigo-600 text-indigo-600 hover:text-white rounded-full flex items-center justify-center transition shadow-sm\"\n                        title=\"Sauvegarder ce voyage\"\n                      >\n                        {saving ? <i className=\"fa-solid fa-spinner animate-spin\"></i> : <i className=\"fa-solid fa-bookmark\"></i>}\n                      </button>\n                    )}\n                  </SignedIn>\n                </div>\n\n\n                <div className=\"flex flex-wrap items-center justify-center gap-4 mt-4\">\n                  <div className=\"inline-block bg-green-100 text-green-700 px-4 py-1 rounded-full text-sm font-bold border border-green-200\">\n                    Budget estim√© : {resultat.budget_total_estime}\n                  </div>\n                  {resultat.meteo && (\n                    <div className=\"inline-flex items-center gap-3 bg-blue-50 text-blue-700 px-4 py-1 rounded-full text-sm font-medium border border-blue-100\">\n                      <span className=\"text-xl\">üå¶Ô∏è</span>\n                      <div className=\"flex flex-col leading-tight text-left\">\n                        <span className=\"font-bold\">{resultat.meteo.temp_min} - {resultat.meteo.temp_max} ‚Ä¢ {resultat.meteo.description}</span>\n                        <span className=\"text-[10px] opacity-80\">{resultat.meteo.conseils}</span>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className='flex justify-center'>\n                <button onClick={() => setResultat(null)} className=\"text-sm font-bold text-slate-400 hover:text-indigo-600 underline\">G√©n√©rer un autre voyage</button>\n              </div>\n\n              {/* Itinerary Builder */}\n              <ItineraryBuilder\n                itinerary={resultat}\n                activeDayIndex={activeDay}\n                setActiveDayIndex={setActiveDay}\n                onUpdate={updateResultat}\n              />\n\n              {/* Transports */}\n              {resultat.transports?.length > 0 && (\n                <div>\n                  <h3 className=\"text-2xl font-serif font-bold text-slate-800 mb-6 flex items-center gap-2\">\n                    <span className=\"bg-indigo-100 p-2 rounded-lg text-xl\">‚úàÔ∏è</span> Transports\n                  </h3>\n                  <div className=\"grid grid-cols-1 gap-4\">\n                    {resultat.transports.map((t: any, i: number) => (\n                      <div key={i} className=\"bg-white p-6 rounded-xl shadow-sm border border-slate-100 border-l-4 border-l-indigo-500 flex justify-between items-center\">\n                        <div>\n                          <div className=\"font-bold text-slate-900 text-lg\">{t.type}</div>\n                          <div className=\"text-slate-500 text-sm\">{t.compagnie}</div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"text-green-600 font-bold text-xl\">{t.prix}</div>\n                          {t.lien && <a href={t.lien} target=\"_blank\" className=\"text-xs text-indigo-500 hover:underline cursor-pointer\">Voir le billet</a>}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Hotels / Resto / Activities */}\n              {[\n                { title: \"H√©bergements\", icon: \"üè®\", data: resultat.hotels, color: \"blue\" },\n                { title: \"Restaurants\", icon: \"üçΩÔ∏è\", data: resultat.restaurants, color: \"orange\" },\n                { title: \"Activit√©s\", icon: \"üéüÔ∏è\", data: resultat.activites, color: \"emerald\" }\n              ].map((section, idx) => (\n                <div key={idx}>\n                  <h3 className=\"text-2xl font-serif font-bold text-slate-800 mb-6 flex items-center gap-2\">\n                    <span className={`bg-${section.color}-100 p-2 rounded-lg text-xl`}>{section.icon}</span> {section.title}\n                  </h3>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n                    {section.data.map((item: any, i: number) => (\n                      <div key={i} className=\"bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-md transition group\">\n                        <div className=\"h-48 overflow-hidden relative\">\n                          <img\n                            src={getImageUrl(item, section.title, resultat.destination)}\n                            className=\"w-full h-full object-cover transform group-hover:scale-105 transition duration-500\"\n                            alt={item.nom}\n                            loading=\"lazy\"\n                          />\n                          <div className=\"absolute top-2 right-2 bg-white/90 backdrop-blur text-xs font-bold px-2 py-1 rounded-md shadow-sm\">\n                            {item.prix_par_nuit || item.prix_moyen || item.prix}\n                          </div>\n                        </div>\n                        <div className=\"p-5\">\n                          <h4 className=\"font-bold text-lg text-slate-800 mb-1\">{item.nom}</h4>\n                          <p className=\"text-sm text-slate-500 mb-3\">{item.emplacement || item.type || item.description}</p>\n                          {item.avis && (\n                            <div className=\"flex items-center gap-1 mb-3 text-sm text-amber-500 font-medium\">\n                              <i className=\"fa-solid fa-star\"></i>\n                              <span>{item.avis}</span>\n                            </div>\n                          )}\n                          {item.lien && (\n                            <a href={item.lien} target=\"_blank\" className=\"text-sm font-semibold text-indigo-600 hover:text-indigo-800 flex items-center gap-1 cursor-pointer\">\n                              En savoir plus <i className=\"fa-solid fa-arrow-up-right-from-square text-xs\"></i>\n                            </a>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              ))}\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-start pt-6 border-t border-slate-100\">\n                <EmergencyButton onEmergency={handleEmergency} />\n              </div>\n\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}